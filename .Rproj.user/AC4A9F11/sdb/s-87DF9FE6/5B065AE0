{
    "collab_server" : "",
    "contents" : "# This script prepares different case studies (currently Tair Antarctica, \n#Soil moisture cookfarm and soil moisture exploratories) and controls the\n#comparison study of different validation and feature selection algorithms.\n\nrm(list=ls())\nlibrary(caret)\nlibrary(Rsenal)\n\n################################################################################\n#user defined settings\n################################################################################\n#paths:\ndatapath <- \"/media/memory01/data/hmeyer/Overfitting/\"\nscriptpath <- \"/home/hmeyer/magic/AnalyzeOverfitting/\" #contains the modelling \n#                                                   function \"02b_trainModels.R\"\noutpath <- paste0(datapath,\"/results_Tair_final/\")\n#sample sizes. 1= entire dataset and is recommended:\nsampsize_Tair <- 1\nsampsize_Soil <- 1\nsampsize_Expl <- 1\n#tune and train settings:\nseed <- 111\ntuneLength <- NA\ntuneGrid <- expand.grid(mtry = 2) # only use one mtry value if already shown \n#                                   that this is the optimal one\nwithinSD <- FALSE #see ?ffs\ndoParallel <- TRUE\ncaseStudy <- c(\"Tair\")#\"cookfarm,\"Tair\"\nalgorithms <- c(\"rf\") #currently only tested with rf\nnfolds_time <- 10 # number of folds for LTOCV\nnfolds_space <- 10 # number of folds for LLOCV\nnfolds_spacetime <- 10 # number of folds for LLTOCV\nmetric=\"RMSE\"\n# define individual models:\nfeatureSelect <- c(\"noSelection\",\"ffs\",\"rfe\")#\"noSelection\",\"ffs\",\"rfe\"\nvalidation <- c(\"llocv\",\"ltocv\",\"lltocv\") #\"cv\",\"llocv\",\"ltocv\",\"lstocv\"\nadditionals <- expand.grid(\"caseStudy\"=caseStudy,\"algorithms\"=algorithms,\n                           \"validation\"=\"cv\",\"featureSelect\"=c(\"noSelection\",\"ffs\",\"rfe\"))\nindividualModels <- expand.grid(\"caseStudy\"=caseStudy,\n                                \"algorithms\"=algorithms,\n                                \"validation\"=validation,\n                                \"featureSelect\"=featureSelect,\n                                stringsAsFactors=FALSE)\nindividualModels <- rbind(additionals,individualModels)\n\n################################################################################\n#set response and predictors for every dataset\n################################################################################\nsource(paste0(scriptpath,\"/02b_trainModels.R\"))\nsetwd(datapath)\nfor (i in 1:nrow(individualModels)){\n  ########################### COOKFARM #########################################\n  if (individualModels$caseStudy[i]==\"cookfarm\"){\n    sampsize <- sampsize_Soil\n    dataset <- get(load(\"Soil.RData\"))\n    dataset <- dataset[complete.cases(dataset),]\n    dataset <- dataset[dataset$altitude==-0.3,]\n    dataset$year <- factor(as.character(substr(dataset$Date,1,4)))\n    dataset$yearmonth <- factor(as.character(substr(dataset$Date,1,7)))\n    dataset <- dataset[substr(dataset$Date,1,4)%in%c(\"2011\",\"2012\",\"2013\"),]\n    response <- \"VW\"\n    predictors <- c(\"DEM\",\"TWI\",\"NDRE.M\",\"NDRE.Sd\",\"Bt\",\"BLD\",\"PHI\",\"Precip_cum\",\n                  \"MaxT_wrcc\",\"MinT_wrcc\",\"cdayt\",\"Crop\")\n    spacevar <- \"SOURCEID\" #for LLOCV\n    timevar <- \"yearmonth\" # for TOCV\n  }\n  ########################### TAIR ANTARCTICA ##################################\n  if (individualModels$caseStudy[i]==\"Tair\"){\n    sampsize <- sampsize_Tair\n    dataset <- get(load(\"Tair.RData\"))\n    dataset <- dataset[complete.cases(dataset),]\n    dataset$time <- as.numeric(dataset$time)\n    dataset$month <- as.numeric(dataset$month)\n    response <- \"statdat\"\n    predictors <- c(\"LST\",\"season\",\"time\",\"month\",\"sensor\",\"dem\",\"slope\",\n                    \"aspect\",\"skyview\",\"ice\")\n    spacevar <- \"station\"\n    timevar <- \"doy\"\n  }\n  ########################### EXPLORATORIES ####################################\n  if (individualModels$caseStudy[i]==\"Expl\"){\n    sampsize <- sampsize_Expl\n    dataset <- get(load(\"dataset_exploratories.RData\"))\n    dataset <- dataset[complete.cases(dataset),]\n#    dataset <- dataset[dataset$Exploratorium==\"ALB\",]\n    dataset$year <- as.factor(dataset$year)\n    dataset <- dataset[dataset$year%in%c(\"2013\"),]\n    dataset$date <- as.character(dataset$date)\n    names(dataset)[which(names(dataset)==\"date\")] <- \"dts\"\n    dataset$month <- as.numeric(dataset$month)\n    dataset$LUI <- as.numeric(dataset$LUI)\n    response <- \"SM_10\"\n    predictors <- c(\n                  \"P_RT_NRT\",\"Ta_200\",\"Exploratorium\",\"elevation\",\"slope\",\n                  \"aspect\",\"bulk\",\"Clay\",\"Fine_Silt\",\"Coarse_Silt\",\"Fine_Sand\",\n                  \"Medium_Sand\",\"Coarse_Sand\",\"SWDR_300\",\"PrecDeriv\",\"month\",\n                  \"doy\",\"LUI\",\"Precip_cum\",\"evaporation\",\"Ts_10\")\n    spacevar <- \"plotID\"\n    timevar <- \"dts\"\n  }\n  ##############################################################################\n  #Run modelling procedure for the respective individual model settings\n  ##############################################################################\n  model <- trainModels (dataset,spacevar=spacevar,timevar=timevar,\n                        sampsize=sampsize,\n                        caseStudy=individualModels$caseStudy[i],\n                        validation=individualModels$validation[i],\n                        featureSelect=individualModels$featureSelect[i],\n                        predictors=predictors,response=response,\n                        algorithm=individualModels$algorithms[i],\n                        outpath=outpath,doParallel=doParallel,\n                        calculate_random_fold_model=TRUE,\n                        withinSD = withinSD,\n                        nfolds_spacetime=nfolds_spacetime,\n                        nfolds_space=nfolds_space,metric=metric,\n                        nfolds_time=nfolds_time,tuneLength=tuneLength,\n                        tuneGrid=tuneGrid,\n                        seed=seed)\n  print(i)\n}",
    "created" : 1498493833206.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4127897211",
    "id" : "5B065AE0",
    "lastKnownWriteTime" : 1498030182,
    "last_content_update" : 1498030182,
    "path" : "~/Documents/Release/environmentalinformatics-marburg/magic/AnalyzeOverfitting/02a_main.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}